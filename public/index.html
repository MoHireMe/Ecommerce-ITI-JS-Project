<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buy Hive</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/css/global.css" />
    <script type="module">
      import { isLoggedIn, checkUserRole, getCurrentUser } from './assets/js/auth.js';
      
      // Function to control UI elements based on authentication status
      function setupAuthUI() {
        // Store authentication state in a global variable
        window.userAuthState = {
          isLoggedIn: isLoggedIn(),
          isCustomer: isLoggedIn() && checkUserRole('customer'),
          isSeller: isLoggedIn() && checkUserRole('seller'),
          isAdmin: isLoggedIn() && checkUserRole('admin'),
          currentUser: getCurrentUser()
        };
        
        // Add classes to the HTML element for CSS targeting
        if (window.userAuthState.isLoggedIn) {
          document.documentElement.classList.add('user-logged-in');
          
          if (window.userAuthState.isCustomer) {
            document.documentElement.classList.add('user-is-customer');
          } else if (window.userAuthState.isSeller) {
            document.documentElement.classList.add('user-is-seller');
          } else if (window.userAuthState.isAdmin) {
            document.documentElement.classList.add('user-is-admin');
          }
        }
      }
      
      // Run immediately
      setupAuthUI();
      
      // Also add a DOMContentLoaded listener for any elements that might not be available yet
      document.addEventListener('DOMContentLoaded', function() {
        const loginBtn = document.querySelector('.login-btn');
        const navButtons = document.querySelector('.nav-buttons');
        const iconsDiv = document.querySelector('.icons');
        const userDropdown = document.getElementById('user-dropdown');
        const customerDropdown = document.getElementById('customer-dropdown');
        const adminSellerDropdown = document.getElementById('admin-seller-dropdown');
        
        if (window.userAuthState.isLoggedIn) {
          // Hide login button for all logged-in users
          if (loginBtn) loginBtn.style.display = 'none';
          if (navButtons) navButtons.style.display = 'none';
          
          // Show appropriate dropdown based on role
          if (window.userAuthState.isCustomer) {
            // Show customer dropdown
            if (iconsDiv) iconsDiv.style.display = 'flex';
            if (customerDropdown) customerDropdown.style.display = 'block';
            if (adminSellerDropdown) adminSellerDropdown.style.display = 'none';
          } else if (window.userAuthState.isSeller || window.userAuthState.isAdmin) {
            // Show admin/seller dropdown
            if (iconsDiv) iconsDiv.style.display = 'flex';
            if (customerDropdown) customerDropdown.style.display = 'none';
            if (adminSellerDropdown) adminSellerDropdown.style.display = 'block';
          }
        } else {
          // User is not logged in, show login button and hide icons
          if (navButtons) navButtons.style.display = 'flex';
          if (iconsDiv) iconsDiv.style.display = 'none';
        }
      });
    </script>
  </head>
  <body>

    <div class="container">
      <nav class="main-nav">

        <div class="mobile-menu-button"><i class="fas fa-bars"></i></div>
    <div class="mobile-sidebar">
      <div class="close-btn"><i class="fas fa-times"></i></div>
      <ul class="sidebar-links">
        <li><a href="/">Home</a></li>
        <li><a href="./product-list.html">Shop</a></li>
        <li><a href="#contactus">Contact</a></li>
      </ul>
    </div>

    
        <a href="/" class="logo">
          <img src="./assets/images/logo.png" alt="Buy Hive Logo" />
        </a>
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="./product-list.html">Shop</a></li>
          <li><a href="#contactus">Contact</a></li>
        </ul>
        <div class="nav-buttons">
          <a href="./login.html" class="login-btn">Login</a>
        </div>
        <div class="icons">
          <div class="user-icon-container">
            <i class="fas fa-user" id="user-icon"></i>
            
            <!-- Customer dropdown menu -->
            <div class="user-dropdown" id="customer-dropdown">
              <a href="/profile/user-profile" class="user-dropdown-item">
                <i class="fas fa-user-edit"></i> Edit Profile
              </a>
              <a href="/profile/user-orders" class="user-dropdown-item">
                <i class="fas fa-shopping-bag"></i> Orders
              </a>
              <a href="#" class="user-dropdown-item" id="logout-btn-customer">
                <i class="fas fa-sign-out-alt"></i> Log Out
              </a>
            </div>
            
            <!-- Admin/Seller dropdown menu -->
            <div class="user-dropdown" id="admin-seller-dropdown" style="display: none;">
              <a href="#" class="user-dropdown-item" id="dashboard-link">
                <i class="fas fa-tachometer-alt"></i> Dashboard
              </a>
              <a href="#" class="user-dropdown-item" id="logout-btn-admin-seller">
                <i class="fas fa-sign-out-alt"></i> Log Out
              </a>
            </div>
          </div>
          <i class="fas fa-shopping-cart"></i>
        </div>
      </nav>

      <section class="hero">
        <div class="hero-content">
          <div class="motto"><h2>WELCOME TO BUY HIVE</h2></div>
          <h1>Your One-Stop Destination for Everything You Love</h1>
        </div>
      </section>



      <section class="categories">
        <h2 style="margin-bottom: 30px">Shop by Category</h2>
        <div class="category-list">
          <a href="./product-list.html?category=Electronics" class="category-link">
            <div class="category-card">
              <img
                src="https://images.unsplash.com/photo-1550009158-9ebf69173e03?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8ZWxlY3Ryb25pY3N8ZW58MHx8MHx8fDA%3D"
                alt="Electronics"
              />
              <p>Electronics</p>
            </div>
          </a>
          <a href="./product-list.html?category=Sneakers" class="category-link">
            <div class="category-card">
              <img
                src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8c25lYWtlcnN8ZW58MHx8MHx8fDA%3D"
                alt="Sneakers"
              />
              <p>Sneakers</p>
            </div>
          </a>
        </div>
      </section>


      <section class="featured">
        <h2 style="margin-bottom: 25px">Featured Products</h2>
        <div class="product-grid" id="featured-products">
          <!-- Product cards will be dynamically inserted here -->
        </div>
      </section>

      <section class="contactus" id="contactus">
        <div class="contactus-container">
          <h2 class="contacttitle">Contact Us</h2>
          <div class="contact-details">
            <div class="address">
              <div class="addresslabel">Address</div>
              <p>123 Main Street, Cairo, Egypt</p>
            </div>
            <div class="customersupport">
              <div class="customerlabel">Support</div>
              <p>Email us at BuyHive@email.com</p>
            </div>
          </div>
          <form class="contact-form">
            <div class="inputs-row">
              <div class="input-group">
                <label for="name">Name</label>
                <input type="text" id="name" placeholder="Your Name" />
              </div>
              <div class="input-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="Your Email" />
              </div>
              <div class="input-group">
                <label for="subject">Subject</label>
                <input type="text" id="subject" placeholder="Subject" />
              </div>
            </div>
            <div class="messageinput">
              <label for="message">Message</label>
              <textarea
                id="message"
                placeholder="Type your message here..."
              ></textarea>
              <button type="submit">Send Message</button>
            </div>
          </form>

          <div class="supporticons">
            <a href="#" class="social-icon"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
          </div>
        </div>
      </section>

      <section class="info-section">
        <div class="info-container">
          <div class="info-column">
            <h4>Products</h4>
            <ul>
              <li><a href="#">› Our Work</a></li>
              <li><a href="#">› Club</a></li>
              <li><a href="#">› News</a></li>
              <li><a href="#">› Announcement</a></li>
            </ul>
          </div>
          <div class="info-column">
            <h4>Information</h4>
            <ul>
              <li><a href="#">› Price</a></li>
              <li><a href="#">› Terms</a></li>
              <li><a href="#">› Affiliates</a></li>
              <li><a href="#">› Blog</a></li>
            </ul>
          </div>
          <div class="info-column">
            <h4>Support</h4>
            <ul>
              <li><a href="#">› Documentation</a></li>
              <li><a href="#">› FAQs</a></li>
              <li><a href="#">› Forums</a></li>
              <li><a href="#">› Contact</a></li>
            </ul>
          </div>
        </div>
      </section>

      <footer class="main-footer">
        <div class="footer-content">
          <p>&copy; 2025 Buy Hive. All rights reserved.</p>
        </div>
      </footer>
    </div>

    <div class="cart-sidebar">
  <div class="cart-header">
    <h3>Your Cart</h3>
    <span class="close-cart"><i class="fas fa-times"></i></span>
  </div>
  <div class="cart-items">
    <p class="empty-cart-msg">No items in the cart yet.</p>
    <!-- Cart items will be inserted here -->
  </div>
  <div class="cart-footer">
    <div class="cart-total">
      Total: $<span id="cart-total">0.00</span>
    </div>
    <button class="checkout-btn">Checkout</button>
  </div>
</div>

    <script
      src="https://kit.fontawesome.com/c49ef8856d.js"
      crossorigin="anonymous"
    ></script>
    <script src="./assets/js/main.js"></script>
    <script type="module">
      import getProductCard from './assets/components/product-card.js';
      import { getAllApprovedProducts } from './assets/js/api.js';
      
      // Function to generate star rating based on a number (1-5)
      function generateStars(rating) {
        const fullStar = '★';
        const emptyStar = '☆';
        let stars = '';
        
        for (let i = 1; i <= 5; i++) {
          if (i <= rating) {
            stars += fullStar;
          } else {
            stars += emptyStar;
          }
        }
        
        return stars;
      }
      
      // Function to render featured products
      async function renderFeaturedProducts() {
        const container = document.getElementById('featured-products');
        if (!container) return;
        
        // Show loading state
        container.innerHTML = '<div class="loading">Loading featured products...</div>';
        
        try {
          // Fetch all approved products
          const products = await getAllApprovedProducts();
          
          // Take only the first 4 products
          const featuredProducts = products.slice(0, 4);
          
          // Clear container
          container.innerHTML = '';
          
          if (featuredProducts.length === 0) {
            container.innerHTML = '<p>No featured products available.</p>';
            return;
          }
          
          // Render each product
          featuredProducts.forEach(product => {
            // Generate random star rating between 3 and 5
            const randomRating = Math.floor(Math.random() * 3) + 3;
            const stars = generateStars(randomRating);
            
            const card = getProductCard(
              product.image,
              product.name, // Using 'name' instead of 'title' as per db.json structure
              stars,
              product.price,
              product.category,
              product.id
            );
            container.appendChild(card);
          });
        } catch (error) {
          console.error('Error fetching featured products:', error);
          container.innerHTML = '<p>Failed to load featured products. Please try again later.</p>';
        }
      }
      
      // Initialize when DOM is loaded
      document.addEventListener('DOMContentLoaded', renderFeaturedProducts);
    </script>
  </body>
</html>
